\chapter{Exploration by Confidence}
\label{cha:expl-conf}

Recall that we have introduced GCIs with high confidence as an approach to extract
terminological knowledge from erroneous data.  For this approach we have seen in
\Cref{sec:comp-conf-bases} that the thus obtained GCIs require an additional validation
step, \ie an expert has to verify whether the extracted GCIs, whose confidence in the data
$\mathcal{I}$ is above a pre-chosen threshold $c \in [0,1]$, are indeed valid in the
domain of interest.

This additional validation step can be very costly, and thus it should be avoided as much
as possible.  On the other hand, we have also seen in \Cref{sec:comp-conf-bases} that as
soon as some GCI has been confirmed, others may be entailed by it, and a manual validation
is no longer necessary.  This observation may indeed save a lot of work.

Even more, utilizing this observation may save computation time as well: if during the
computation of bases of $\Th_c(\mathcal{I})$ an expert already rejects a GCI and confirms
that some counterexamples for it, which are present in $\mathcal{I}$, are indeed correct,
then all GCIs which are falsified by this counterexamples can also be rejected,
irrespective of whether their confidence in $\mathcal{I}$ is above $c$.  It is thus
desirable to allow expert interaction already during the time of the computation of bases
of $\Th_c(\mathcal{I})$, and not only at the end of the computation, as a separate
validation step.

There is also another issue which requires expert interaction, and which has already been
addressed by Distel~\cite{Diss-Felix}: the data $\mathcal{I}$ may not only contain errors,
but it may also be \emph{incomplete} in the sense that it lacks certain counterexamples,
meaning that some GCIs are valid in $\mathcal{I}$, even so they are not valid in the
domain of interest.  If $\mathcal{I}$ contains errors, it may additionally happen that
some invalid GCIs $C \sqsubseteq D$ are only falsified in $\mathcal{I}$ by erroneous
counterexamples, and that correct counterexamples are not present in $\mathcal{I}$.  In
such a case, the GCI $C \sqsubseteq D$ would be accepted (since all counterexamples are
erroneous) although it is not valid.  Here an expert could, as soon as $C \sqsubseteq D$
would be computed as an element of a base, provide correct counterexamples, inhibiting
this GCI from being included in a base.  Such provided counterexamples would also affect
the following computation, as all GCIs invalided by it would also be rejected.

The approach followed by Distel to solve this problem is to adapt attribute exploration
from its original setting of implications and formal contexts to the setting of GCIs and
finite interpretations.  Recall that the attribute exploration algorithm, which we had
discussed previously in \Cref{sec:attr-expl}, solves a problem which is very similar to
the one sketched above: given a finite formal context $\con K$, we want to compute a base
of the domain which is represented by $\con K$.  However, it may be the case that $\con K$
does not completely represent the domain we are interested in, \ie some implications which
are not valid in our domain actually hold in $\con K$.  Then attribute exploration
provides an interactive base computation procedure which, as soon as an implication is
computed, presents it to the expert and asks for validation.  If the expert confirms this
implication, then the implication is added to the base.  If the expert does not confirm
this implication, she has to provide a counterexample, which is included in $\con K$.  At
the end, the attribute exploration algorithm yields a base of the domain we are interested
in, and not only one for the formal context $\con K$.

Distel's generalizations of attribute exploration to the setting of GCIs and finite
interpretation are called \emph{model exploration} and \emph{ABox exploration}.  Their
abstract behavior is very similar to the one of attribute exploration: during the
computation of a base of $\mathcal{I}$, GCIs $C \sqsubseteq D$ are asked to the expert.
If confirmed, they are added to the base.  If rejected, the expert has to provide a
counterexample which is being added to $\mathcal{I}$.  Upon termination, the algorithm
yields a base of the domain which is represented by the expert.

Model exploration and ABox exploration differ in the way counterexamples are provided.  In
model exploration, counterexamples are directly added to the interpretation $\mathcal{I}$,
whereas in ABox exploration the counterexamples are being added to a separate ABox.  While
the latter is much more user-friendly from the point of view how much needs to be
specified from a counterexample, it is also much more technical and complicated.
Therefore, we shall concentrate in this work on model exploration only.

In the following two chapters we want to generalize model exploration to our setting of
extracting GCIs with high confidence from finite interpretations.  More precisely, what we
want to obtain is an algorithm that computes bases of $\Th_c(\mathcal{I})$, and, as soon
as a GCI for the base is computed, asks the expert for validation.  As above, the expert
may confirm or reject this GCI, where in the latter case she has to provide a
counterexample.  Upon termination, the algorithm should yield a base of the domain which
is represented by the expert, to the extent in which this domain is contained in
$\Th_c(\mathcal{I})$.  We shall make this more precise in \Cref{sec:expl-conf}.

However, before we can discuss model exploration in our setting of GCIs with high
confidence, we first want to adapt attribute exploration to the setting of implications
with high confidence.  This \emph{exploration by confidence} should work the same way as
attribute exploration works, with the notable difference that not only valid implications
are asked, but also those which have a high confidence in the formal context.  Within this
generalization, we have to deal with the problem that counterexamples provided by the
expert are not subject to the confidence measure, as we assume that the expert only gives
valid counterexamples: a single counterexample provided by the expert suffices to reject a
GCI, even if it otherwise has enough confidence in the data.  We shall discuss this
problem along with its solution in detail in \Cref{sec:expl-conf}.

Our discussion of exploration by confidence will be based on a more general discussion of
attribute exploration, which we shall conduct in \Cref{sec:an-abstract-view}.  Therein, we
shall view attribute exploration from a more general and more formal perspective.  This
generalization will allow us to not only explore formal contexts, but also to explore
arbitrary sets of implications, and in our discussion of exploration by confidence these
sets will be of the form $\Th_c(\con K)$.  For this, we shall introduce two variants of a
\emph{generalized attribute exploration}, one which in its technical details is very
closely related to attribute exploration, and one which is more liberal in the way
implications are computed.  Finally, we shall also give a formal specification an
\emph{expert} has to satisfy for our exploration algorithms (including the classical
attribute exploration) to work.

The results presented in this section have been published previously in
\cite{Borch-LTCS-13-04}.

\section{Exploring Sets of Implications}
\label{sec:an-abstract-view}

Let $M$ be a finite set and $\mathcal{L} \subseteq \Imp(M)$.  In this section we want to
discuss how we can turn attribute exploration into an algorithm for \emph{exploring
  $\mathcal{L}$}.  To this end, we shall first give another perspective on the attribute
exploration algorithm that we have already met in \Cref{sec:attr-expl}.  Based upon this,
we shall introduce in \Cref{sec:gener-form-attr} a \emph{generalized attribute
  exploration} that allows us to explore $\mathcal{L}$.  Finally, we introduce in
\Cref{sec:weak-gener-attr} another generalization that provides more freedom in the way
implications are computed.  This generalization later allows us to develop an algorithm
for exploration by confidence in which all implications asked to the expert have high
confidence in the data.

\subsection{Another Perspective on Attribute Exploration}
\label{sec:class-attr-expl}

Recall that in attribute exploration as we had introduced it in \Cref{sec:attr-expl} we
assume that the domain of interest can be represented by a formal context $\con
K_{\mathsf{back}}$, which we call the \emph{background context} of the exploration.  The
goal of attribute exploration is then to find a base of $\con K_{\mathsf{back}}$, without
having direct access to $\con K_{\mathsf{back}}$.  For this we start with a subcontext
$\con K = (G, M, I)$ of $\con K_{\mathsf{back}}$, the \emph{working context} of the
exploration, and a set $\mathcal{K} \subseteq \Imp(M)$ of implications which are valid in
$\con K_{\mathsf{back}}$, which we call the set of \emph{known implications}.  Then we
successively compute implications of the form
\begin{equation*}
  P \to P''
\end{equation*}
where $P$ is a $\mathcal{K}$-pseudo intent of $\con K$, and in particular is closed under
the set of currently known implications, but is not an intent of the current working
context.  Those implications are presented to the expert, who either confirms or rejects
it.

We can view this procedure from a more general perspective\todo{I think Bernhard talked
  about that in his exploration lecture -- find a reference!}: given the formal context
$\con K$, we know that all implications in $\Imp(M) \setminus \Th(\con K)$ \emph{are not}
valid in $\con K_{\mathsf{back}}$, and thus are not valid in our domain.  On the other
hand, all implications in $\Th(\con K)$ \emph{could} be valid in $\con K_{\mathsf{back}}$,
depending on whether counterexamples contained in $\con K_{\mathsf{back}}$ invalidate
implications being valid in $\con K$ or not.  However, what we are certain of is that all
implications in $\mathcal{K}$ \emph{are} valid in our domain, and thus all implications in
$\Cn(\mathcal{K})$ are.

Hence, we have the situation that we have three sets of implications, namely the set of
\emph{all} implications $\Imp(M)$, the set $\Th(\con K)$ of \emph{possibly valid}
implications, and the set of \emph{certainly valid} implications $\Cn(\mathcal{K})$.
These sets are related by
\begin{equation*}
  \Imp(M) \supseteq \Th(\con K) \supseteq \Cn(\mathcal{K}),
\end{equation*}
since $\mathcal{K}$ is supposed to be sound for $\con K$.

Now the set
\begin{equation*}
  \Th(\con K) \setminus \Cn(\mathcal{K})
\end{equation*}
can be seen as the set of \emph{undecided} implications, \ie the set of those implications
which are possibly valid in $\con K_{\mathsf{back}}$, but from which we do not know yet
whether they indeed are valid in $\con K_{\mathsf{back}}$ or not (since we do not have
direct access to $\con K_{\mathsf{back}}$).  Then attribute exploration can be viewed as a
\emph{systematic search} through the set $\Th(\con K) \setminus \Cn(\mathcal{K})$, in the
sense that the crucial feature for attribute exploration to work is to be able to compute
implications
\begin{equation}
  \label{eq:33}
  (P \to P'') \in \Th(\con K) \setminus \Cn(\mathcal{K}),
\end{equation}
provided that $\Th(\con K) \setminus \Cn(\mathcal{K}) \neq \emptyset$.  We shall argue now
why this is indeed enough.

Let $(P \to P'') \in \Th(\con K) \setminus \Cn(\mathcal{K})$.  Then the implication $P \to
P''$ is proposed to the expert.  If she accepts $P \to P''$, then we add this implication
to $\mathcal{K}$, and we obtain the following situation:
\begin{equation*}
  \Imp(M) \supseteq \Th(\con K) \supseteq \Cn(\mathcal{K} \cup \set{ P \to P'' })
  \supsetneq \Cn(\mathcal{K}).
\end{equation*}
If the expert rejects $P \to P''$, she has to provide a counterexamples, \ie a set $C
\subseteq M$ such that $P \subseteq C$ and $P'' \not\subseteq C$.  Denote with $\con K +
C$ the formal context which arises from $\con K$ by adding a new object $g_C$ to $\con K$
which has exactly the attributes which are contained $C$, \ie which satisfies
\begin{equation*}
  (g_C)' := C
\end{equation*}
where the derivation is done in $\con K + C$.  Then the situation from above evolves into
\begin{equation*}
  \Imp(M) \supseteq \Th(\con K) \supsetneq \Th(\con K + C) \supseteq \Cn(\mathcal{K}).
\end{equation*}

If $\Th(\con K) \setminus \Cn(\mathcal{K}) = \emptyset$, then the algorithm terminates.
Note that this indeed has to happen since the base set $M$ is finite.  We then obtain the
situation\footnote{We read $\con K + C_1 + \dots + C_m$ as $(\dots(\con K + C_1) + \dots )
  + C_m$ and nothing else.}
\begin{align*}
  \Imp(M) &\supseteq \Th(\con K) \supsetneq \Th(\con K + C_1) \supsetneq \dots \supsetneq
  \Th(\con K + C_1 + \dots + C_m) \\ &= \Cn(\mathcal{K} \cup \set{ P_1 \to P_1'', \dots, P_n
    \to P_n'' }) \supsetneq \dots \supsetneq \Cn(\mathcal{K})
\end{align*}
where $m, n \in \NN_{\geq 0}$, $C_1, \dots, C_m, P_1, \dots, P_n \subseteq M$, and where
all derivations are done in $\con K + C_1 + \dots + C_m$.  It is true that
\begin{equation*}
  \Th(\con K + C_1 + \dots + C_m) = \Th(\con K_{\mathsf{back}}) = \Cn(\mathcal{K} \cup
  \set{ P_1 \to P_1'', \dots, P_n \to P_n'' })
\end{equation*}
just because
\begin{equation*}
  \Th(\con K + C_1 + \dots + C_i) \supseteq \Th(\con K_{\mathsf{back}}) \supseteq
  \Cn(\mathcal{K} \cup \set{ P_1 \to P_1'', \dots, P_j \to P_j''} )
\end{equation*}
for all $1 \leq i \leq m$ and $1 \leq j \leq n$.  In particular, the set
\begin{equation*}
  \set{P_1 \to P_1'', \dots, P_n \to P_n''}
\end{equation*}
is a base of $\con K_{\mathsf{back}}$ with background knowledge $\mathcal{K}$, as
required.

Note that this discussion did not require that the set $P$ from \Cref{eq:33} is a
$\mathcal{K}$-pseudo intent of $\con K$.  The only necessary requirement is that $P \neq
P''$ and that $P \to P''$ does not follow from $\mathcal{K}$.  Both these properties are
guaranteed by $P$ being a $\mathcal{K}$-pseudo intent of $\con K$, but this is not
necessary.

On the other hand, if we want to compute the canonical base of $\con K_{\mathsf{back}}$
with background knowledge $\mathcal{K}$, then $P$ obviously needs to be a
$\mathcal{K}$-pseudo intent of $\con K$.  However, since attribute exploration should
compute \emph{some} base of $\con K_{\mathsf{back}}$, we can see the computation of
$\Can(\con K_{\mathsf{back}}, \mathcal{K})$ as an optimization, and not as a crucial
requirement.

\subsection{A Generalized Form of Attribute Exploration}
\label{sec:gener-form-attr}

The foregone considerations suggest that we can view attribute exploration as an algorithm
that allows us to ``explore'' the set $\Th(\con K) \setminus \Cn(\mathcal{K})$ of
undecided implications.  In this section we want to generalize this view to the setting
where the set of undecided implications has a more general form.  To make this more
precisely, let $M$ be a finite set, $\mathcal{L} \subseteq \Imp(M)$ and let $\mathcal{K}
\subseteq \Cn(\mathcal{L})$.  As we have viewed the set $\Th(\con K)$ before as the set of
possibly valid implications, we can now view the set $\mathcal{L}$ as the set of possibly
valid implications.  Then the set of undecided implications takes the form
\begin{equation*}
  \mathcal{L} \setminus \Cn(\mathcal{K})
\end{equation*}
and we want to obtain an algorithm that guides us in finding all valid implications in
$\mathcal{L} \setminus \Cn(\mathcal{K})$.  More precisely, we want to compute a base of
all implications valid in $\mathcal{L}$, using $\mathcal{K}$ as background knowledge.  As
before, we assume that we do not have direct access to the background context $\con
K_{\mathsf{back}}$, \ie we cannot simply compute $\mathcal{L} \cap \Th(\con
K_{\mathsf{back}})$, but that we are given an expert that allows us to either validate or
reject implications.

Before we discuss this problem in more detail, let us consider that it indeed is a
problem: at first sight, one may be tempted to say that exploring $\mathcal{L}$ can be
achieved (at least in theory) by considering the formal context
\begin{equation*}
  \con K_{\mathcal{L}} = (\set{ \mathcal{L}(X) \mid X \subseteq M }, M, \ni)
\end{equation*}
which already appeared in \Cref{prop:context-model-for-implications}.  This proposition
tells us that $\Th(\con K_{\mathcal{L}}) = \Cn(\mathcal{L})$, and thus one could propose
that for exploring $\mathcal{L}$ it would just be sufficient to explore $\con
K_{\mathcal{L}}$.

However, besides the fact that computing $\con K_{\mathcal{L}}$ (or a subcontext of it
which still has $\Cn(\mathcal{L})$ as its theory) is far from practical, this approach
also does not solve our initial problem, because in general $\mathcal{L} =
\Cn(\mathcal{L})$ does not hold.

\begin{Example}
  \label{expl:why-exploring-implications-is-different}
  Let $M = \set{ \mathsf{a}, \mathsf{b}, \mathsf{c} }, \mathcal{K} = \emptyset,
  \mathcal{L} = \set{ \set{ \mathsf{a} } \to \set{ \mathsf{b} } }$ and suppose that our
  domain can be represented by the formal context
  \begin{equation*}
    \begin{array}{c|ccc}
      \toprule
      \con K_{\mathsf{back}} & \mathsf{a} & \mathsf{b} & \mathsf{c} \\
      \midrule
      x & \times \\
      \bottomrule
    \end{array}
  \end{equation*}
  Then clearly $\Th(\con K_{\mathsf{back}}) \cap \mathcal{L} = \emptyset$, and thus the
  only base of this set is the empty set.  On the other hand,
  \begin{equation*}
    (\set{ \mathsf{a}, \mathsf{c} } \to \set{ \mathsf{b} }) \in
    \Cn(\mathcal{L}) \cap \Th(\con K_{\mathsf{back}}),
  \end{equation*}
  and therefore bases of $\Th(\con K_{\mathsf{back}}) \cap \Cn(\mathcal{L})$ are not empty.
\end{Example}

We now want to discuss an algorithm that allows us to explore $\mathcal{L} \setminus
\Cn(\mathcal{K})$, \ie which successively computes implications $(P \to Q) \in
\Cn(\mathcal{L}) \setminus \Cn(\mathcal{K})$ and asks them to the expert for validation.
At the end, the set of accepted implications should form a base of $\mathcal{L} \cap
\Th(\con K_{\mathsf{back}})$ with background knowledge $\mathcal{K}$.

Intuitively, the algorithm should work as attribute exploration does: if $P \to Q$ is
accepted by the expert, then it is added to $\mathcal{K}$.  If it is rejected by the
expert, then a counterexamples $C$ has to be provided by the expert.  In this case, all
implications from $\mathcal{L}$ for which $C$ is a counterexample are removed.  The
algorithm terminates if $\mathcal{L} \setminus \Cn(\mathcal{K}) = \emptyset$ (in which
case also $\Cn(\mathcal{L}) \setminus \Cn(\mathcal{K}) = \emptyset$ holds).

We want to make this intuition more precise, and for this we shall make use of the
argumentation that we have developed in the previous section.  To keep our argumentation
formal, however, we shall first start with a formalization of the notion of an
\emph{expert} that we heretofore have used only intuitively.

\begin{Definition}[Domain Expert]
  \label{def:domain-expert}
  Let $M$ be a set.  A \emph{domain expert} on $M$ is a function
  \begin{equation*}
    p \colon \Imp(M) \to \set{ \top } \cup \subsets{M},
  \end{equation*}
  where $\top \notin \subsets M$, and which satisfies the following conditions
  \begin{enumerate}[i. ]
  \item if $(X \to Y) \in \Imp(M)$ such that $p(X \to Y) = C \neq \top$, then $C \subseteq
    X$ and $C \not\subseteq Y$, (\emph{$p$ gives counterexamples for false implications})
  \item if $(U \to V), (X \to Y) \in \Imp(M)$ such that $p(U \to V) = \top, p(X \to Y) = C
    \neq \top$, then $C$ is not a counterexample for $U \to V$, \ie either $C
    \not\subseteq U$ or $C \subseteq V$. (\emph{counterexamples from $p$ do not invalidate
      confirmed implications})
  \end{enumerate}
  We say that $p$ \emph{confirms} $(X \to Y) \in \Imp(M)$ if and only if $p(X \to Y) =
  \top$.  Otherwise, we say that $p$ \emph{rejects} $X \to Y$ and \emph{provides $C = p(X
    \to Y)$ as a counterexample}.  Finally, the \emph{theory} $\Th(p)$ of $p$ is the set
  of all implications over $M$ which are confirmed by $p$.
\end{Definition}

We have not specified the notion of a \emph{domain} formally, but instead required that
every domain is representable by a formal context.  With our formalization of an expert we
can now show that experts provide an equally good approach to formalize the notion of a
domain.

\begin{Proposition}
  \label{prop:domain-expert-from-domain}
  Let $\con K = (G, M, I)$ be a formal context.  For each $(A \to B) \in \Imp(M) \setminus
  \Th(\con K)$ let $g_{A \to B} \in G$ such that $A \subseteq g_{A \to B}', B
  \not\subseteq g_{A \to B}'$.  Then the mapping $p_{\con K} \colon \Imp(M) \to \set{ \top } \cup
  \subsets M$ defined by
  \begin{equation*}
    p_{\con K}(X \to Y) :=
    \begin{cases}
      g_{X \to Y} & (X \to Y) \notin \Th(\con K) \\
      \top & \text{otherwise}
    \end{cases}
  \end{equation*}
  is a domain expert on $M$, and $\Th(\con K) = \Th(p_{\con K})$.
\end{Proposition}
\begin{Proof}
  Clearly, if $(X \to Y) \notin \Th(\con K)$, then $p_{\con K}(X \to Y) = g_{X \to Y}$ is
  a counterexample for $X \to Y$.  If $(X \to Y) \in \Th(\con K)$, then for all $g \in G$
  it is true that either $g' \not\subseteq X$ or $g' \subseteq Y$.  Thus, no
  counterexample provided by $p_{\con K}$ is a counterexample for $X \to Y$.  Therefore,
  counterexamples provided by $p$ do not invalidate confirmed implications.  The equality
  $\Th(\con K) = \Th(p_{\con K})$ is clear from the definition of $p_{\con K}$.
\end{Proof}

Note that the actual definition of $p_{\con K}$ depends on the particular choice of the
objects $g_{A \to B}$, and thus $\con K$ can give rise to more than one domain expert.

If we have given a domain expert, we can easily construct a formal context from it that
has the same theory.

\begin{Proposition}
  \label{prop:domain-from-domain-expert}
  Let $p$ be domain expert on a set $M$.  Then the formal context $\con K_p = (G, M, \ni)$,
  where
  \begin{equation*}
    G := \set{ p(X \to Y) \mid (X \to Y) \in \Imp(M) \setminus \Th(p) }
  \end{equation*}
  is such that $\Th(p) = \Th(\con K_p)$.
\end{Proposition}
\begin{Proof}
  If $(A \to B) \in \Th(p)$, then no counterexample provided by $p$ invalidates $A \to
  B$.  Since the rows of $\con K_p$ consist of the counterexamples provided by $p$, $\con
  K_p$ does not contain a counterexample for $A \to B$ and thus $(A \to B) \in \Th(\con
  K_p)$.

  If $p(A \to B) \notin \Th(p)$, then $p(A \to B) \subseteq M$ is a counterexample for $A
  \to B$ and therefore $(A \to B) \notin \Th(\con K_p)$.
\end{Proof}

In particular, for every domain expert $p$ on $M$ and every formal context $\con K = (G,
M, I)$ it is true that
\begin{align*}
  \Th(p) &= \Th(p_{\con K_p}), \\
  \Th(\con K) &= \Th(\con K_{p_{\con K}}).
\end{align*}
In other words, the representation of domains as formal context and in terms of domain
experts is, from a logical point of view, interchangeable.

With this formal notion of an expert we can reformulate our goal of exploring sets of
implications.  Let $M$ be a finite set, $p$ a domain expert on $M$, $\mathcal{L} \subseteq
\Imp(M)$ and $\mathcal{K} \subseteq \Th(p) \cap \Cn(\mathcal{L})$.  Then to \emph{explore
  $\mathcal{L}$ with expert $p$ and background knowledge $\mathcal{K}$} means to compute a
base of
\begin{equation*}
  \mathcal{L} \cap \Th(p)
\end{equation*}
with background knowledge $\mathcal{K}$.

\todo[inline]{Write: move reformulation to chapter about FCA}

To find an algorithm that allows us to explore $\mathcal{L}$ we want to suitably adapt the
classical attribute exploration algorithm, as we have described it in the previous
section.  For this we first transform the attribute exploration algorithm as given in
\Cref{alg:attribute-exploration} into a simpler form, and then adapt it to our setting of
exploring $\mathcal{L}$.

\addfunctionname{explore-implications,next-closed-non-closed}

\begin{figure}[tp]
  \begin{Algorithm}[Another Implementation of Attribute Exploration]
  \label{alg:explore-attributes-with-next-closed-none-closed}
  \hspace*{0cm}
\begin{lstlisting}
define next-closed-non-closed($M$, $\leq_M$, $A$, $\mathcal{K} \subseteq \Imp(M)$, $\mathcal{L} \subseteq \Imp(M)$)
  ;; computes the lectically smallest element greater or equal to $A$ that is closed
  ;; under $\mathcal{K}$ and not closed under $\mathcal{L}$

  if $A$ = nil then
    return nil
  else if $A = \mathcal{K}(A)$ and $A \neq \mathcal{L}(A)$ then
    return $A$
  else
    return next-closed-non-closed($M$, $\leq_M$, next-closure($M$, $\leq_M$, $A$, $\mathcal{K}$), $\mathcal{K}$, $\mathcal{L}$)
  end if
end

define explore-attributes($M$, $\leq_M$, $p$, $\con K = (G, M, I)$, $\mathcal{K} \subseteq
\Th(p)$)
  $i$ := 0, $\con K_i$ := $\con K$, $\mathcal{K}_i$ := $\mathcal{K}$, $P_i$ := $\emptyset$

  forever do
    $P_{i+1}$ := next-closed-non-closed($M$, $\leq_M$, $P_i$, $\mathcal{K}_i$, $(.)_{\con K_i}''$)
    if $P_{i+1} =$ nil exit

    if $p(P_{i+1} \to (P_{i+1})_{\con K_i}'') = \top$ then
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i \cup \set{ P_{i+1} \to (P_{i+1})_{\con K_i}'' }$
      $\con K_{i+1}$ := $\con K_i$
    else
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i$
      $C$ := $p(P_{i+1} \to (P_{i+1})_{\con K_i}'')$
      $\con K_{i+1}$ := $\con K_i + C$
    end

    $i$ := $i + 1$
  end while

  return $\mathcal{K}_i$  
end
\end{lstlisting}
  \end{Algorithm}
\end{figure}

In \Cref{alg:attribute-exploration} we have used the special functions to compute the
lectically first closed set that is not an intent of a given formal context, and to
compute the lectically next closed set of a given closure operator that is not an intent
of the current working context.  However, a closer inspection of the way these functions
are used yields that the actual computation required for the classical attribute
exploration algorithm is to have a way to compute for a given set $A \subseteq M$ the
lectically smallest set lectically greater \emph{or equal} to $A$ that is not an intent of
the current working context but is closed under a given closure operator.  An
implementation of this function, which we shall call \lstinline{next-closed-non-closed},
is given in \Cref{alg:explore-attributes-with-next-closed-none-closed}.  This function
suffices to implement attribute exploration, and the corresponding listing is also shown
in \Cref{alg:explore-attributes-with-next-closed-none-closed}.

We want to use this reformulation of \lstinline{explore-attributes} to generalize it to an
algorithm that allows us to explore $\mathcal{L}$.  For this recall our initial
formulation of attribute exploration as given in \Cref{sec:class-attr-expl}.  We can view
this formulation as a special case of exploring $\mathcal{L}$, namely for $\mathcal{L} =
\Th(\con K)$.  During the run of the algorithm this set is transferred into sets of the
form
\begin{equation*}
  \Th(\con K + C_1 + \dots + C_i)
\end{equation*}
for $C_1, \dots, C_i \subseteq M$.  The operation that yields this transformation can
easily be formulated on the level of implications only.  For this we observe that
$\Th(\con K + C)$ is the set of all implications which are valid in $\con K$ and which are
not invalidated by $C$, \ie
\begin{equation}
  \label{eq:35}
  \Th(\con K + C) = \set{ (A \to B) \in \Th(\con K) \mid A \not\subseteq C \text{ or } B
    \subseteq C }.
\end{equation}
Using this simple equation we can now replace $\Th(\con K)$ by $\mathcal{L}$ in our
formulation of attribute exploration as given
\Cref{alg:explore-attributes-with-next-closed-none-closed} to obtain an algorithm that
allows us to explore $\mathcal{L}$.  The result is shown in
\Cref{alg:explore-implications}.

\begin{figure}[tp]
  \centering
  \begin{Algorithm}[Exploration of Sets of Implications]
    \label{alg:explore-implications}
    \hspace*{0cm}
\begin{lstlisting}
define explore-implications($M$, $\leq_M$, $p$, $\mathcal{L} \subseteq \Imp(M)$, $\mathcal{K} \subseteq \Th(p)$)
  $i$ := 0, $\mathcal{L}_i$ := $\mathcal{L}$, $\mathcal{K}_i$ := $\mathcal{K}$, $P_i$ := $\emptyset$

  while $P_i \neq$ nil do
    $P_{i+1}$ := next-closed-non-closed($M$, $\leq_M$, $P_i$, $\mathcal{K}_i$, $\mathcal{L}_i$)

    if $p(P_{i+1} \to \mathcal{L}_i(P_{i+1})) = \top$ then
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i \cup \set{ P_{i+1} \to \mathcal{L}_i(P_{i+1}) }$
      $\mathcal{L}_{i+1}$ := $\mathcal{L}_i$
    else
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i$
      $C$ := $p(P_{i+1} \to \mathcal{L}_i(P_{i+1}))$
      $\mathcal{L}_{i+1}$ := $\set{ (A \to B) \in \mathcal{L}_i \mid A \not\subseteq C
\text{ or } B \subseteq C }\label{lst:explore-implications-1}$
    end

    $i$ := $i + 1$
  end while

  return $\mathcal{K}_i$  
end
\end{lstlisting}
  \end{Algorithm}
\end{figure}

We now claim that \lstinline{explore-implications} yields an algorithm to explore
$\mathcal{L}$, using $p$ as domain expert and $\mathcal{K}$ as background knowledge.  For
this we need to argue that the algorithm always terminates and, upon termination, yields a
base of $\Th(p) \cap \mathcal{L}$ with background knowledge $\mathcal{K}$.  Moreover,
since \lstinline{explore-implications} arose from \lstinline{explore-attributes} by simple
syntactic substitutions it is reasonable to expect that the base we obtain for $\Th(p)
\cap \mathcal{L}$ is actually the canonical base of this set, \ie
\lstinline{explore-implications} computes
\begin{equation*}
  \Can(\Th(p) \cap \mathcal{L}, \mathcal{K}).
\end{equation*}

Showing these claims is the purpose of the rest of this section, and we start with a
technical observation.
\begin{Proposition}
  \label{prop:technicalities-about-explore-implications}
  Let $M$ be a finite set, $p$ a domain expert on $M$, $\mathcal{L} \subseteq \Imp(M)$ and
  $\mathcal{K} \subseteq \Th(p)$.  The for iteration $i$ of the run of
  \lstinline{explore-implications} with this input, it is true that
  $\mathcal{K}_i\setminus \mathcal{K} \subseteq \Cn(\mathcal{L}_i)$\todo{needed
    anywhere?}.  Furthermore, $\mathcal{K}_i \subseteq \mathcal{K}_{i+1}$ and
  $\mathcal{L}_i \supseteq \mathcal{L}_{i+1}$, and exactly one of these inclusions is
  strict.
\end{Proposition}
\begin{Proof}
  Suppose that we are in iteration $i$.  Then clearly $\mathcal{K}_i \subseteq
  \mathcal{K}_{i+1}$ and $\mathcal{L}_i \supseteq \mathcal{L}_{i+1}$ from the very
  definition of these sets.  Then, if $p$ confirms $P_{i+1} \to \mathcal{L}_i(P_{i+1})$,
  then $\mathcal{K}_i \subsetneq \mathcal{K}_{i+1}$ and $\mathcal{L}_i =
  \mathcal{L}_{i+1}$.  If $p$ rejects $P_{i+1} \to \mathcal{L}_i(P_{i+1})$, and $C =
  p(P_{i+1} \to \mathcal{L}_i(P_{i+1}))$, then there must exist at least one implication
  $(A \to B) \in \mathcal{L}_i$ such that $A \subseteq C$ and $B \not\subseteq C$, for
  otherwise $C$ cannot be a counterexample for $P_{i+1} \to \mathcal{L}_i(P_{i+1})$.
  Therefore, $\mathcal{L}_i \supsetneq \mathcal{L}_{i+1}$, and $\mathcal{K}_i =
  \mathcal{K}_{i+1}$ holds by definition.

  We show that claim $\mathcal{K}_i \setminus \mathcal{K} \subseteq \Cn(\mathcal{L}_i)$ be
  induction.  The base case is clear, as $\mathcal{K}_i \setminus \mathcal{K} =
  \mathcal{K} \setminus \mathcal{K} = \emptyset$.

  For the step case assume $\mathcal{K}_i\setminus \mathcal{K} \subseteq
  \Cn(\mathcal{L}_i)$, and assume that $P_{i+1} \neq \text{\lstinline{nil}}$.  Then
  $P_{i+1} = \mathcal{K}_i(P_{i+1})$ and $P_{i+1} \neq \mathcal{L}_i(P_{i+1})$.

  If $p$ confirms $P_{i+1} \to \mathcal{L}_i(P_{i+1})$, then $\mathcal{L}_i =
  \mathcal{L}_{i+1}$.  Since $\mathcal{K}_i \subseteq \Cn(\mathcal{L}_i)$ and $(P_{i+1}
  \to \mathcal{L}_i(P_{i+1})) \in \Cn(\mathcal{L}_i)$, it is true that $\mathcal{K}_{i+1}
  \subseteq \Cn(\mathcal{L}_{i+1})$.

  If $p$ rejects $P_{i+1} \to \mathcal{L}_i(P_{i+1})$, then $\mathcal{K}_{i+1} =
  \mathcal{K}_i$.  Let $C := p(P_{i+1} \to \mathcal{L}_i(P_{i+1}))$.  If we define
  \begin{align*}
    \Th(C)
    &:= \set{ (A \to B) \in \Imp(M) \mid A \not\subseteq C \text{ or } B \subseteq C } \\
    &= \Th((C, M, \ni))
  \end{align*}
  then
  \begin{equation*}
    \mathcal{L}_{i+1} = \mathcal{L}_i \cap \Th(C).
  \end{equation*}
  Since $p$ does not provide counterexamples to confirmed implications we obtain
  \begin{equation*}
    \mathcal{K}_i \setminus \mathcal{K} \subseteq \Th(C).
  \end{equation*}
  Therefore
  \begin{align*}
    \Cn(\mathcal{L}_{i+1})
    &= \Cn(\Th(C) \cap \mathcal{L}_i) \\
    &= \Cn(\Th(C) \cap \Cn(\mathcal{L}_i)) \\
    &\supseteq \Cn(\mathcal{K}_i \setminus \mathcal{K}) \\
    &\supseteq \mathcal{K}_{i+1} \setminus \mathcal{K}
  \end{align*}
  since $\Cn(\mathcal{L}_i) \supseteq \mathcal{K}_i \setminus \mathcal{K}$ and
  $\mathcal{K}_{i+1} = \mathcal{K}_i$.
\end{Proof}

This enables us to show termination.

\begin{Theorem}
  \label{thm:explore-implications-termination}
  Let $M$ be a finite set, $\leq_M$ a linear order on $M$, $p$ a domain expert on $M$,
  $\mathcal{L} \subseteq \Imp(M)$ and $\mathcal{K} \subseteq \Th(p)$.  Then
  \lstinline{explore-implications} applied to these arguments terminates after finitely
  many steps.
\end{Theorem}
\begin{Proof}
  Note that \lstinline{explore-implications} has to terminate if $\Cn(\mathcal{L}_i)
  \setminus \Cn(\mathcal{K}_i) = \emptyset$.  By
  \Cref{prop:technicalities-about-explore-implications} we now that $\mathcal{K}_i
  \subseteq \mathcal{K}_{i+1}$ or $\mathcal{L}_i \supseteq \mathcal{L}_{i+1}$, and exactly
  one of these inclusions is strict.  The latter fact entails
  \begin{equation}
    \label{eq:36}
    \Cn(\mathcal{L}_{i+1}) \setminus \Cn(\mathcal{K}_{i+1}) \subsetneq \Cn(\mathcal{L}_i)
    \setminus \Cn(\mathcal{K}_i)
  \end{equation}
  This is because if $\mathcal{K}_i \neq \mathcal{K}_{i+1}$ then the implication $P_{i+1}
  \to \mathcal{L}_i(P_{i+1})$ added to $\mathcal{K}_{i}$ does not follow from
  $\mathcal{K}_i$, because $P_{i+1} = \mathcal{K}_{i}(P_{i+1})$.  Thus,
  $\Cn(\mathcal{K}_i) \subsetneq \Cn(\mathcal{K}_{i+1})$.  On the other hand, if
  $\mathcal{L}_i \neq \mathcal{L}_{i+1}$, then
  \begin{equation*}
    (P_{i+1} \to \mathcal{L}_i(P_{i+1})) \in \Cn(\mathcal{L}_i) \setminus \Cn(\mathcal{L}_{i+1})
  \end{equation*}
  and $\Cn(\mathcal{L}_i) \supsetneq \Cn(\mathcal{L}_{i+1})$.

  If the algorithm would run forever, it would thus yield an infinite descending chain
  \begin{equation*}
    \Cn(\mathcal{L}_0) \setminus \Cn(\mathcal{K}_0) \supsetneq \Cn(\mathcal{L}_1)
    \setminus \Cn(\mathcal{K}_1) \supsetneq \dots.
  \end{equation*}
  Since $M$ is finite, $\subsets{\Imp(M)}$ is finite and therefore this cannot happen.
  Thus the algorithm has to terminate.
\end{Proof}

We now consider the correctness of \lstinline{explore-implications}.

\begin{Proposition}
  \label{prop:explore-implications-closedness-persists}
  Let $M$ be a finite set, $p$ a domain expert on $M$, $\leq_M$ a linear order on $M$,
  $\mathcal{L} \subseteq \Imp(M)$ and $\mathcal{K} \subseteq \Th(p)$.  Denote with
  $\preceq$ the lectic order on $\subsets M$ induced by $\leq_M$.  Then in every iteration
  $i$ of the run of \lstinline{explore-implications} with this input such that $P_{i+1}
  \neq \text{\lstinline{nil}}$, it is true that for $A \prec P_{i+1}$, if $A$ is
  $\mathcal{K}_i$-closed, then $A$ is $\mathcal{L}_i$-closed as well.
\end{Proposition}
\begin{Proof}
  We show the claim by induction on $i$.  For the base case $i = 0$ the claim is vacuously
  true, since $P_1$, if not \lstinline{nil}, is the lectically smallest set which is
  $\mathcal{K}_0$-closed but not $\mathcal{L}_i$-closed.

  For the step case we assume that $P_{i+2} \neq \text{\lstinline{nil}}$.  We then need to
  show that for all $A \prec P_{i+2}$, if $A$ is $\mathcal{K}_{i+1}$-closed, then $A$ is
  also $\mathcal{L}_{i+1}$-closed.

  Thus let $A \prec P_{i+2}$ and $A$ be $\mathcal{K}_{i+1}$-closed.  Let us first consider
  the case $A \prec P_{i+1}$.  Since $\mathcal{K}_i \subseteq \mathcal{K}_{i+1}$, $A$ is
  also $\mathcal{K}_i$-closed.  By induction hypothesis, $A$ is also
  $\mathcal{L}_i$-closed, and since $\mathcal{L}_{i+1} \subseteq \mathcal{L}_i$, we obtain
  that $A$ is $\mathcal{L}_{i+1}$-closed.

  If $P_{i+1} = P_{i+2}$, nothing remains to be shown.  Therefore assume that $P_{i+1}
  \neq P_{i+2}$ and let $P_{i+1} \preceq A \prec P_{i+2}$.  By construction, all sets
  strictly between $P_{i+1}$ and $P_{i+2}$ are $\mathcal{L}_{i+1}$-closed if
  $\mathcal{K}_{i+2}$-closed, by definition of $P_{i+2}$.

  Therefore, it only remains to consider the case $A = P_{i+1} \neq P_{i+2}$.  But then
  since $A$ is $\mathcal{K}_{i+2}$-closed and $P_{i+1} \neq P_{i+2}$ we know that
  $P_{i+1}$ is not $\mathcal{L}_{i+1}$-closed, as otherwise $P_{i+1} = P_{i+2}$.
  Therefore, $A = P_{i+1}$ is $\mathcal{L}_{i+1}$-closed as required.
\end{Proof}

\begin{Corollary}
  \label{cor:explore-implications-closures-coincide}
  Let $M$, $\leq_M$, $p$, $\mathcal{L}$, $\mathcal{K}$ as before, and denote with $n$ the
  number of iterations of the algorithm \lstinline{explore-implications} when applied to
  this input.  Then
  \begin{equation*}
    \Cn(\mathcal{K}_n) = \Cn(\mathcal{L}_n \cup \mathcal{K}).
  \end{equation*}
\end{Corollary}
\begin{Proof}
  We have already shown $\Cn(\mathcal{K}_n \setminus \mathcal{K}) \subseteq
  \Cn(\mathcal{L}_n)$ in \Cref{prop:technicalities-about-explore-implications}, and thus
  $\Cn(\mathcal{K}_n) \subseteq \Cn(\mathcal{L}_n \cup \mathcal{K})$.

  By the previous \Cref{prop:explore-implications-closedness-persists} we know that all
  $\mathcal{K}_n$-closed subsets of $M$ are also $\mathcal{L}_n$-closed.  Let $(X \to Y)
  \in \Cn(\mathcal{L}_n)$.  Then $Y \subseteq \mathcal{L}_n(X) \subseteq
  \mathcal{L}_n(\mathcal{K}_n(X))$.  Clearly, $\mathcal{K}_n(X)$ is
  $\mathcal{K}_n$-closed, so \Cref{prop:explore-implications-closedness-persists} yields
  that $\mathcal{K}_n(X)$ is also $\mathcal{L}_n$-closed, \ie
  \begin{equation*}
    \mathcal{L}_n(\mathcal{K}_n(X)) = \mathcal{K}_n(X).
  \end{equation*}
  Thus, $Y \subseteq \mathcal{K}_n(X)$ and therefore $(X \to Y) \in \Cn(\mathcal{K}_n)$.
  Clearly, $\mathcal{K} \subseteq \Cn(\mathcal{K}_n)$, and thus $\Cn(\mathcal{K}_n)
  \supseteq \Cn(\mathcal{L}_n \cup \mathcal{K})$ as required.
\end{Proof}

\begin{Corollary}
  \label{cor:explore-implications-L_n-exactly-those-confirmed-by-expert}
  Let $M$, $\leq_M$, $p$, $\mathcal{L}$, $\mathcal{K}$ as before, and let again $n$ be
  the number of iterations of the run of \lstinline{explore-implications} when applied to
  this input.  Then
  \begin{equation*}
    \mathcal{L}_n = \Th(p) \cap \mathcal{L}.
  \end{equation*}
\end{Corollary}
\begin{Proof}
  We know that $\Th(p) \cap \mathcal{L} \subseteq \mathcal{L}_{n}$, since $p$ does not
  provide counterexamples for confirmed implications.  Since $\Cn(\mathcal{L}_{n} \cup
  \mathcal{K}) = \Cn(\mathcal{K}_{n})$, we obtain $\mathcal{L}_{n} \subseteq
  \Cn(\mathcal{K}_{n})$.  Since all implications in $\mathcal{K}_{n}$ are confirmed by
  $p$, it is true that $\Cn(\mathcal{K}_{n}) \subseteq \Th(p)$.  Together with
  $\mathcal{L}_{n} \subseteq \mathcal{L}$ we thus obtain $\mathcal{L}_{n} \subseteq \Th(p)
  \cap \mathcal{L}$.
\end{Proof}

From the results obtained this far we can now conclude our main result that the function
\lstinline{explore-implications} computes a base of $\mathcal{L} \cap \Th(p)$ with
background knowledge $\mathcal{K}$.

\begin{Theorem}
  \label{thm:explore-implications-correctness}
  Let $M$ be a finite set, $\leq_{M}$ be a linear order on $M$, $p$ a domain expert on
  $M$, $\mathcal{L} \subseteq \Imp(M)$ and $\mathcal{K} \subseteq \Th(p) \cap
  \Cn(\mathcal{L})$.  Denote with $n$ the last iteration of
  \lstinline{explore-implications} applied to this input.  Then $\mathcal{K}_{n} \setminus
  \mathcal{K}$ is a base of $\Th(p) \cap \mathcal{L}$ with background knowledge
  $\mathcal{K}$, \ie
  \begin{equation*}
    \Cn(\mathcal{K}_{n}) = \Cn(\Th(p) \cap \mathcal{L}).
  \end{equation*}
\end{Theorem}
\begin{Proof}
  If $\mathcal{K} \subseteq \Cn(\mathcal{L})$, then $\mathcal{K} \subseteq
  \Cn(\mathcal{L}_{n})$ and \Cref{cor:explore-implications-closures-coincide} yields
  $\Cn(\mathcal{K}_{n}) = \Cn(\mathcal{L}_{n})$.  Thus
  \begin{equation*}
    \Cn(\mathcal{K}_{n}) = \Cn(\mathcal{L}_{n}) = \Cn(\Th(p) \cap \mathcal{L})
  \end{equation*}
  by \Cref{cor:explore-implications-L_n-exactly-those-confirmed-by-expert}.
\end{Proof}

The counterexamples given by the expert $p$ during the run of the algorithm can be
collected into a formal context $\con L$.  Then this formal context $\con L$ has the nice
property that every implication in $\mathcal{L}$ is either entailed by $\mathcal{K}_{n}$
or does not hold in $\con L$.  This fact can be useful on its own.

\begin{Theorem}
  \label{thm:explore-implications-counterexamples-context}
  Let $M$ be a finite set, $\leq_{M}$ a linear order on $M$, $p$ a domain expert on $M$,
  $\mathcal{L} \subseteq \Imp(M)$ and $\mathcal{K} \subseteq \Th(p) \cap
  \Cn(\mathcal{L})$.  Let $n$ denote the last iteration of
  \lstinline{explore-implications} applied to this input, and let $\set{ C_{1}, \dots,
    C_{m} }$ be the counterexamples given by $p$ during this run.  Denote with $\con L$
  the formal context which arises from these counterexamples, \ie
  \begin{equation*}
    \con L = (\set{ C_{1}, \dots, C_{m} }, M, \ni).
  \end{equation*}
  Then for each implication $(A \to B) \in \mathcal{L}$ it is true that either $(A \to B)
  \in \Cn(\mathcal{K}_{n})$ or $(A \to B) \notin \Th(\con L)$.
\end{Theorem}
\begin{Proof}
  We first observe that
  \begin{equation}
    \label{eq:40}
    \mathcal{L}_{n} = \Th(\con L) \cap \mathcal{L}.
  \end{equation}
  Then from \Cref{cor:explore-implications-closures-coincide} and $\mathcal{K} \subseteq
  \Cn(\mathcal{L})$ we obtain as before that $\Cn(\mathcal{K}_{n}) =
  \Cn(\mathcal{L}_{n})$, and thus
  \begin{equation}
    \label{eq:37}
    \Cn(\mathcal{K}_{n}) = \Cn(\mathcal{L}_{n}) = \Cn(\Th(\con L) \cap \mathcal{L}).
  \end{equation}
  Suppose that $(A \to B) \not\in \Cn(\mathcal{K}_{n})$.  Then $(A \to B) \not\in
  \Cn(\Th(\con L) \cap \mathcal{L})$ by \Cref{eq:37}.  Since $(A \to B) \in \mathcal{L}$,
  we obtain $(A \to B) \not\in \Th(\con L)$ as required.
\end{Proof}

We have now established the correctness of our algorithm for exploring sets of
implications.  However, as mentioned before, we can further extend our results and show
that the base that is computed by \lstinline{explore-implications} is the canonical base
of $\mathcal{L} \cap \Th(p)$ with background knowledge $\mathcal{K}$.

Note that we had introduce the canonical base in \Cref{sec:bases-implications} only for
formal contexts, but it is not very difficult to generalize the definition (and the
corresponding results) to the level of sets of implications.  Indeed, if $\mathcal{L},
\mathcal{K} \subseteq \Imp(M)$, then the canonical base of $\mathcal{L}$ with background
knowledge $\mathcal{K}$ can just be defined to be the canonical base of $\con
K_{\mathcal{L}}$ with background knowledge $\mathcal{K}$, where $\con K_{\mathcal{L}}$ is
defined as in \Cref{prop:context-model-for-implications}.  However, we can also be a bit
more specific and generalize the notion of pseudo-intents correspondingly, by considering
the closure operator induced by $\mathcal{L}$ to be a generalization of the double-prime
operator $(\cdot)''$ of a formal context.

\begin{Definition}[$\mathcal{K}$-Pseudo-Closed Set of $\mathcal{L}$, Canonical Base]
  \label{def:pseudo-intents-for-implications}
  Let $M$ be a finite set and let $\mathcal{L}, \mathcal{K} \subseteq \Imp(M)$.  Then a
  set $P \subseteq M$ is called a \emph{$\mathcal{K}$-pseudo-closed set} of $\mathcal{L}$
  if and only if
  \begin{enumerate}[i. ]
  \item $P \neq \mathcal{L}(P)$,
  \item $P = \mathcal{K}(P)$, and
  \item for all $Q \subsetneq P$ being a $\mathcal{K}$-pseudo-closed set of $\mathcal{L}$
    it is true that $\mathcal{L}(Q) \subseteq P$.
  \end{enumerate}
  The \emph{canonical base} of $\mathcal{L}$ with background knowledge $\mathcal{K}$ is
  then defined as
  \begin{equation*}
    \Can(\mathcal{L}, \mathcal{K}) := \set{ P \to \mathcal{L}(P) \mid P \subseteq M \text{
        a } \mathcal{K} \text{ pseudo-closed set of } \mathcal{L} }.
  \end{equation*}
\end{Definition}

The relevant property of the canonical base now carries over to this generalized
formulation, just because
\begin{equation*}
  \Can(\mathcal{L}, \mathcal{K}) = \Can(\con K_{\mathcal{L}}, \mathcal{K}).
\end{equation*}
Thus, the following corollary follows directly from
\Cref{thm:canonical-base-with-arbitrary-background-knowledge}.

\begin{Corollary}
  \label{cor:canonical-base-for-implications}
  Let $M$ be a finite set and let $\mathcal{L}, \mathcal{K} \subseteq \Imp(M)$.  Then
  $\Can(\mathcal{L}, \mathcal{K})$ is a set of valid implications of $\mathcal{L}$ such
  that
  \begin{equation*}
    \Can(\mathcal{L}, \mathcal{K}) \cup \mathcal{K}
  \end{equation*}
  is complete for $\mathcal{L}$, and $\Can(\mathcal{L}, \mathcal{K})$ has minimal
  cardinality with this property.

  In particular, if $\mathcal{K} \subseteq \Cn(\mathcal{L})$, then $\Can(\mathcal{L},
  \mathcal{K})$ is a minimal base of $\mathcal{L}$ with background knowledge
  $\mathcal{K}$.
\end{Corollary}

We now show that \lstinline{explore-implications} computes the canonical base of $\Th(p)
\cap \mathcal{L}$ with background knowledge $\mathcal{K}$.

\begin{Theorem}
  \label{thm:explore-implications-computes-canonical-base}
  Let $M$ be a finite set, $\leq_{M}$ be a linear order on $M$, $p$ a domain expert on
  $M$, $\mathcal{L} \subseteq \Imp(M)$ and $\mathcal{K} \subseteq \Th(p) \cap
  \mathcal{L}$.  If
  \begin{equation*}
    \mathcal{K}_{n} = \text{\lstinline{explore-implications}}(M, \leq_{M}, p, \mathcal{L}, \mathcal{K}),
  \end{equation*}
  then
  \begin{equation*}
    \Can(\mathcal{L}, \mathcal{K}) = \mathcal{K}_{n} \setminus \mathcal{K}.
  \end{equation*}
\end{Theorem}
\begin{Proof}
  We start with some simple observations first.  Note that for each implication $(P_{i}
  \to \mathcal{L}_{i-1}(P_{i})) \in \mathcal{K}_{n} \setminus \mathcal{K}$ it is true that
  \begin{equation}
    \label{eq:38}
    \mathcal{L}_{i-1}(P_{i}) = \mathcal{K}_{n}(P_{i})
  \end{equation}
  because of
  \begin{equation*}
    \mathcal{K}_{n}(P_{i}) = \mathcal{L}_{n}(P_{i}) \subseteq
    \mathcal{L}_{i-1}(P_{i}) \subseteq \mathcal{K}_{n}(P_{i}),
  \end{equation*}
  and the last inclusion holds because $(P_{i} \to \mathcal{L}_{i-1}(P_{i})) \in
  \mathcal{K}_{n} \setminus \mathcal{K}$.

  Furthermore, it is easy to see that $\mathcal{K}_{n} \setminus \mathcal{K}$ is an
  irredundant base of $\mathcal{K}_{n}$ with background knowledge $\mathcal{K}$, \ie no
  implication in $\mathcal{K}_{n}$ follows from the others and $\mathcal{K}$.

  We are now going to show that the premises in $\mathcal{K}_{n} \setminus \mathcal{K}$
  are all $\mathcal{K}$-pseudo-closed sets of $\mathcal{K}_{n}$.  For this, we show the
  following claim by induction over the number $i$ of iterations:
  \begin{quote}
    For every iteration $i$, the $k := \abs{ \mathcal{K}_{n} \setminus \mathcal{K} }$
    lectically first $\mathcal{K}$-pseudo-closed sets of $\mathcal{K}_{n}$ are precisely
    the premises of the implications in $\mathcal{K}_{n} \setminus \mathcal{K}$.  If the
    $(k+1)$st $\mathcal{K}$-pseudo-closed set $Q$ of $\mathcal{K}_{n}$ exists, then
    $P_{i+1} \subseteq M$ (\ie is not \lstinline{nil}), and $P_{i+1} \preceq Q$.
  \end{quote}

  For the base case $i = 0$ we observe that $\abs{ \mathcal{K}_{0} \setminus \mathcal{K} }
  = 0$, thus the first part of the claim holds.  If $Q$ is the first
  $\mathcal{K}$-pseudo-closed set of $\mathcal{K}_{n}$, then $Q$ is $\mathcal{K}$-closed
  but not $\mathcal{K}_{n}$-closed.  But then $Q$ is also not $\mathcal{L}$-closed,
  because $\mathcal{K}_{n} \subseteq \Cn(\mathcal{L})$.  Therefore, by construction,
  $P_{1}$ is not \lstinline{nil} and $P_{1} \preceq Q$.

  For induction step we assume that the claim holds for iteration $i$.  Let $k := \abs{
    \mathcal{K}_{i} \setminus \mathcal{K} }$.  If there is no more
  $\mathcal{K}$-pseudo-closed set of $\mathcal{K}_{n}$ which is not already a premise of
  an implication in $\mathcal{K}_{i} \setminus \mathcal{K}$, then $\mathcal{K}_{i}$ is a
  base of $\mathcal{K}_{n}$ with background knowledge $\mathcal{K}$.  Since
  $\mathcal{K}_{i} \subseteq \mathcal{K}_{n}$ we obtain $\mathcal{K}_{i} =
  \mathcal{K}_{n}$, since $\mathcal{K}_{n}$ is irredundant.  Then $i = n$, or $i < n$ and
  $\abs{ \mathcal{K}_{i+1} \setminus \mathcal{K}_{n} } = k$ and the claim holds for
  iteration $i+1$ as well.

  Now assume that $Q$ is the $(k+1)$st $\mathcal{K}$-pseudo-closed set of
  $\mathcal{K}_{n}$.  By induction hypothesis, $P_{i+1} \subseteq M$ and $P_{i+1} \preceq
  Q$.  We consider two main cases.

  \textit{Case $Q = P_{i+1}$}:  If $\mathcal{L}_{i}(P_{i+1}) \subseteq
  \mathcal{K}_{n}(P_{i+1})$, then $p$ accepts the implication
  \begin{equation*}
    P_{i+1} \to \mathcal{L}_{i}(P_{i+1}),
  \end{equation*}
  which is then an element of $\mathcal{K}_{i+1}$.  Thus, the $\abs{ \mathcal{K}_{i+1}
    \setminus \mathcal{K} } = k + 1$ lectically first $\mathcal{K}$-pseudo-closed sets of
  $\mathcal{K}_{n}$ are precisely the premises of the implications in $\mathcal{K}_{i+1}
  \setminus \mathcal{K}$.

  If the $(k+2)$nd $\mathcal{K}$-pseudo-closed set $\bar Q$ of $\mathcal{K}_{n}$ exists,
  then in particular $\bar Q$ is closed under $\mathcal{K}_{i+1}$, as for each
  $\mathcal{K}$-pseudo-closed set $P_{\ell} \subseteq \bar Q$ it is true tat
  $\mathcal{K}_{n}(P_{\ell}) \subseteq \bar Q$.  Furthermore, $\bar Q$ is not
  $\mathcal{K}_{n}$-closed, and thus also not $\mathcal{L}_{i+1}$-closed.  Therefore, by
  construction $P_{i+2} \subseteq M$, \ie is not \lstinline{nil}, and $P_{i+2} \preceq Q$.

  If $\mathcal{L}_{i}(P_{i+1}) \not\subseteq \mathcal{K}_{n}(P_{i+1})$, then $p$ rejects
  the implication $P_{i+1} \to \mathcal{L}_{i}(P_{i+1})$ and provides a counterexample.
  Then $\mathcal{K}_{i+1} = \mathcal{K}_{i}$.  Since $P_{i+1} = Q$, the set $P_{i+1}$ is
  also not $\mathcal{L}_{i+1}$-closed, as otherwise it would be $\mathcal{K}_{n}$-closed.
  Thus, $P_{i+2} = P_{i+1}$ and $P_{i+2} \preceq Q$ as required.

  \textit{Case $Q \precneq P_{i+1}$}:  In this case, the set $P_{i+1}$ must be
  $\mathcal{K}_{n}$-closed, since otherwise it would be a $\mathcal{K}$-pseudo-closed set
  of $\mathcal{K}_{n}$, and $P_{i+1} \succeq Q$ would hold.  To see this, we first observe
  that $P_{i+1}$ is $K_{i}$-closed by definition, and thus also $\mathcal{K}$-closed.
  Furthermore, if $\bar Q \subsetneq P_{i+1}$ is a $\mathcal{K}$-pseudo-closed set of
  $\mathcal{K}_{n}$, then by induction hypothesis, the set $\bar Q$ is a premise of
  $\mathcal{K}_{i}$ and therefore $\mathcal{K}_{n}(\bar Q) \subseteq P_{i+1}$.  Thus, the
  only possibility for $P_{i+1}$ to not be a $\mathcal{K}$-pseudo-closed set of
  $\mathcal{K}_{n}$ is that $P_{i+1}$ is $\mathcal{K}_{n}$-closed.

  In addition, $P_{i+1}$ is not $\mathcal{L}_{i}$-closed by definition.  Thus, since
  $P_{i+1}$ is $\mathcal{K}_{n}$-closed, the expert rejects the implication $P_{i+1} \to
  \mathcal{L}_{i}(P_{i+1})$.  Therefore, $\mathcal{K}_{i+1} = \mathcal{K}_{i}$ and
  $P_{i+2}$ is the lectically smallest $\mathcal{K}_{i+1}$-closed, not
  $\mathcal{L}_{i+1}$-closed set which is lectically greater or equal to $P_{i+1}$.  Since
  $Q$ is also $\mathcal{K}_{i+1}$-closed (by induction hypothesis, as it is a
  $\mathcal{K}$-pseudo-closed set of $\mathcal{K}_{n}$) but not $\mathcal{L}_{i+1}$-closed
  (since $Q$ is not $\mathcal{K}_{n}$-closed), it is true that $P_{i+2} \preceq Q$ by
  construction.

  This finishes the step case and the proof of the above claim.

  Using this claim, we shall now show the theorem.  If $n$ denotes the last iteration of
  the algorithm, we known that $P_{n+1}$ is equal to \lstinline{nil}.  Therefore, there
  cannot exist a $\mathcal{K}$-pseudo-closed set of $\mathcal{K}_{n}$ which is not a
  premise of an implication in $\mathcal{K}_{n} \setminus \mathcal{K}$.  Thus
  \begin{align*}
    \mathcal{K}_{n} \setminus \mathcal{K}
    &= \Can(\mathcal{K}_{n}, \mathcal{K}) \\
    &= \Can(\mathcal{L}_{n}, \mathcal{K}) \\
    &= \Can(\Th(p) \cap \mathcal{L}, \mathcal{K})
  \end{align*}
  because of \Cref{cor:explore-implications-closures-coincide} and
  \Cref{cor:explore-implications-L_n-exactly-those-confirmed-by-expert}.  
\end{Proof}

\subsection{A Weaker Generalization of Attribute Exploration}
\label{sec:weak-gener-attr}

We have seen how we can adapt attribute exploration to allow us to explore arbitrary sets
of implications.  Our initial motivation to consider this generalization of attribute
exploration was to be able explore sets of the form $\Th_{c}(\con K)$ for arbitrary
choices of $c \in [0,1]$.  However, for this particular application our algorithm does not
seem very practical, as during a run we then would need to compute sets of the form
$\mathcal{L}_{i}(P)$ for some $\mathcal{L}_{i} \subseteq \Th_{c}(\con K)$ and $P \subseteq
M$.  For $c = 1$ this is not a problem, since
\begin{equation*}
  \Th_{1}(\con K)(P) = \Th(\con K)(P) = P''.
\end{equation*}
For $c \neq 1$, however, such a simple computation is not known.  Although we shall
discuss in \Cref{sec:expl-conf-1} some techniques to still achieve the computation of
$\Th_{c}(\con K)(P)$, the computation itself is potentially much more expensive than in
the case $c = 1$.

To alleviate this problem, we shall discuss another algorithm for exploring sets of
implications which does not require to compute closures of the form $\mathcal{L}(P)$ for
arbitrary sets $\mathcal{L}$.  More precisely, instead of asking questions of the form
$P_{i+1} \to \mathcal{L}_{i}(P_{i+1})$, it will be sufficient to find \emph{some} $Q
\subseteq M$ such that $P_{i+1} \subsetneq Q \subseteq \mathcal{L}_{i}(P_{i+1})$, and then
ask the implication $P \to Q$ to the expert.  If finding such a set $Q$ is even infeasible
than it seems questionable whether exploration itself can be conducted effectively.

We have to pay for the freedom of choosing the set $Q$ as we want by potentially asking
more questions, since the implication
\begin{equation*}
  P_{i+1} \to \mathcal{L}_{i}(P_{i+1}) \setminus Q
\end{equation*}
still needs to be examined by the expert.  The hope is then that the freedom of leaving
out elements from $\mathcal{L}_{i}(P_{i+1})$ compensates for this extra amount of
implications the expert has to handle.

We now present a generalization of \Cref{alg:explore-implications} that uses these ideas.
In this generalization we still require to be able to test whether a set $P$ is closed
under the set $\mathcal{L}_{i}$ or not.  However, this test can most often be decided
without computing $\mathcal{L}_{i}(P)$.

\addfunctionname{explore-implications/weaker-version}

\begin{figure}[tp]
  \begin{Algorithm}[Generalized Exploration of Sets of Implications]
    \label{alg:explore-implications-weaker-version}
    \hspace*{0cm}
\begin{lstlisting}
define explore-implications/weaker-version($M$, $\leq_{M}$, $p$, $\mathcal{L} \subseteq \Imp(M)$, $\mathcal{K} \subseteq \Th(p)$)
  $i$ := 0, $\mathcal{L}_i$ := $\mathcal{L}$, $\mathcal{K}_i$ := $\mathcal{K}$, $P_i$ := $\emptyset$

  forever do
    $P$ := next-closed-non-closed($M$, $\leq_M$, $P_i$, $\mathcal{K}_i$, $\mathcal{L}_i$)$\label{lst:explore-implications-weaker-version-1}$
    if $P =$ nil exit
    choose $P_{i+1} \subseteq M \text{ such that } P_{i} \preceq P_{i+1} \preceq P \text{ and }
P_{i+1} \text{ not } \mathcal{L}_{i}\text{-closed}$
    choose $Q \subseteq M \text{ such that } P_{i+1} \subsetneq Q \subseteq \mathcal{L}_{i}(P_{i+1})$.

    if $p(P_{i+1} \to Q) = \top$ then
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i \cup \set{ P_{i+1} \to Q }$
      $\mathcal{L}_{i+1}$ := $\mathcal{L}_i$
    else
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i$
      $C$ := $p(P_{i+1} \to Q)$
      $\mathcal{L}_{i+1}$ := $\set{ (A \to B) \in \mathcal{L}_i \mid A \not\subseteq C
\text{ or } B \subseteq C }$
    end

    $i$ := $i + 1$
  end while

  return $\mathcal{K}_i$  
end
\end{lstlisting}
  \end{Algorithm}
\end{figure}

Let us consider the algorithm \lstinline{explore-implications/weaker-version} as given in
\Cref{alg:explore-implications-weaker-version}.  This algorithm is very similar to our
implementation of \lstinline{explore-implications} as given in
\Cref{alg:explore-implications}, but differs in a crucial aspect:  we still compute sets
of the form
\begin{equation*}
  P = \text{\lstinline{next-closed-non-closed}}(M, \leq_{M}, P_{i}, \mathcal{K}_{i}, \mathcal{L}_{i})
\end{equation*}
but we then do not directly ask $P \to \mathcal{L}_{i}(P)$ to the expert.  Instead, we
allow the algorithm to choose a set $P_{i+1}$ such that
\begin{equation*}
  P_{i} \preceq P_{i+1} \preceq P
\end{equation*}
and $P_{i+1}$ is not $\mathcal{L}_{i}$-closed.  Note that such a set always exists since
$P$ is not $\mathcal{L}_{i}$-closed.

Since $P_{i+1}$ is not $\mathcal{L}_{i}$-closed, $P_{i+1} \subsetneq
\mathcal{L}_{i}(P_{i+1})$.  We then choose a set $Q$ such that
\begin{equation*}
  P_{i+1} \subsetneq Q \subseteq \mathcal{L}_{i}(P_{i+1})
\end{equation*}
and finally ask the implication $P \to Q$ to the expert.

Note that if we always choose $P_{i+1} = P$ and $Q = \mathcal{L}_{i}(P_{i+1})$, then we
obtain the function \lstinline{explore-implications} again.

We now argue that \lstinline{explore-implications/weaker-version} is indeed an algorithm
that allows to explore $\mathcal{L}$, using $p$ as an expert and $\mathcal{K}$ as
background knowledge.  For this we first observe that termination can be argued as in the
case of \Cref{alg:explore-implications}, and therefore the analog of
\Cref{thm:explore-implications-termination} holds.

\begin{Theorem}
  \label{thm:explore-implications-weaker-version-termination}
  Let $M$ be a finite set, $\leq_{M}$ a linear order on $M$, $p$ be a domain expert on
  $M$, $\mathcal{L} \subseteq \Imp(M)$ and $\mathcal{K} \subseteq \Th(p)$.  Then the call
  \begin{equation*}
    \text{\lstinline{explore-implications/weaker-version}}(M, \leq_{M}, p, \mathcal{L}, \mathcal{K})
  \end{equation*}
  terminates after finitely many steps.
\end{Theorem}

For the correctness of \lstinline{explore-implications/weaker-version} we can argue in
practically the same way as we did for \lstinline{explore-implications}.  The crucial
argument there was \Cref{prop:explore-implications-closedness-persists}, which also holds
in this case, with nearly the same proof.  We shall repeat it nevertheless for easier
comparison.

\begin{Proposition}
  \label{prop:explore-implications-weaker-version-closedness-persists}
  Let $M$, $\leq_{M}$, $p$, $\mathcal{L}$, $\mathcal{K}$ as before.  Then for every
  iteration $i$ in the run of
  \begin{equation*}
    \text{\lstinline{explore-implications/weaker-version}}(M, \leq_{M}, p, \mathcal{L}, \mathcal{K})
  \end{equation*}
  if $P_{i+1}$ is not \lstinline{nil}, it is true for all $A \prec P_{i+1}$ that, if $A$
  is $\mathcal{K}_{i}$-closed, then $A$ is also $\mathcal{L}_{i}$-closed.
\end{Proposition}
\begin{Proof}
  We again show the claim by induction over $i$.  For the base case $i = 0$ we know that
  $P_{i} = \emptyset$, and thus the claim is vacuously true.

  For the step case assume the validity of the proposition for iteration $i$.  Then if
  $P_{i+2}$ is not \lstinline{nil} we need to show that for each $A \preceq P_{i+2}$, if
  $A$ is $\mathcal{K}_{i+1}$-closed, then $A$ is also $\mathcal{L}_{i+1}$-closed.

  As before we can reduce this to the case that $P_{i+1} \preceq A \precneq P_{i+2}$ and
  $A$ being $\mathcal{K}_{i+1}$-closed.  In particular $P_{i+1} \neq P_{i+2}$.  Then
  $P_{i+1} = A$ is the only interesting case, since all sets strictly lectically lying
  between $P_{i+1}$ and $P_{i+2}$ which are $\mathcal{K}_{i+1}$-closed are also
  $\mathcal{L}_{i+1}$-closed, due to the construction of $P_{i+2}$.  Since $P_{i+1} \neq
  P_{i+2}$ we know that $P_{i+1}$ must also be $\mathcal{L}_{i+1}$-closed, as otherwise
  the algorithm would compute $P_{i+1} = P_{i+2}$.  Thus, $A = P_{i+1}$ is also
  $\mathcal{L}_{i+1}$-closed, as required.
\end{Proof}

Now most of the properties of \lstinline{explore-implications} carry over.  However, since
we do not ask implications of the form
\begin{equation}
  \label{eq:39}
  P_{i+1} \to \mathcal{L}_{i}(P_{i+1})
\end{equation}
anymore, we can also not expect that the algorithm computes the canonical base of
$\mathcal{L} \cap \Th(p)$ with background knowledge $\mathcal{K}$.  In particular this
means that the number of implications asked to and confirmed by the expert is not
necessarily minimal anymore.

\begin{Theorem}
  \label{thm:explore-implications-weaker-version-all-other-properties}
  Let $M$ be a finite set, $\leq_{M}$ be a linear order on $M$, $p$ a domain expert on
  $M$, $\mathcal{L} \subseteq \Imp(M)$ and $\mathcal{K} \subseteq \Th(p) \cap
  \Cn(\mathcal{L})$.  Denote with $n$ the last iteration of the run of
  \begin{equation*}
    \text{\lstinline{explore-implications/weaker-version}}(M, \leq_{M}, p, \mathcal{L}, \mathcal{K}).
  \end{equation*}
  Then
  \begin{enumerate}[i. ]
  \item $\Cn(\mathcal{K}_{n}) = \Cn(\mathcal{L}_{n})$,
  \item $\mathcal{L}_{n} = \Th(p) \cap \mathcal{L}$, and
  \item $\Cn(\mathcal{K}_{n}) = \Cn(\Th(p) \cap \mathcal{L})$.
  \end{enumerate}
\end{Theorem}

\section{Exploration by Confidence}
\label{sec:expl-conf}

We now want to use the algorithms we have developed for exploring sets of implications to
solve our initial problem, namely the exploration of implications with high confidence in
some given formal context $\con K = (G, M, I)$.  In other words, if $c \in [0,1]$ is
given, then we want to explore the set $\Th_{c}(\con K)$.  In doing so, we generalize
attribute exploration such that it not only asks implications which are valid in $\con K$,
but also presents to the expert implications whose confidence is high enough in the data.
As described in the introduction of this chapter, this \emph{exploration by confidence} is
exactly the generalization of attribute exploration we wanted to achieve.

As a first step to achieve an algorithm for exploration by confidence we shall instantiate
\Cref{alg:explore-implications} for $\mathcal{L} = \Th_{c}(\con K)$.  While this approach
is conceptually trivial, it entails some technical problems, the most serious of them
being able to compute closures of the form
\begin{equation*}
  \Th_{c}(\con K)(P)
\end{equation*}
for sets $P \subseteq M$.  We discuss some approaches how to achieve this computation more
efficiently than by iterating through $\Th_{c}(\con K)$, which are, however, still
potentially expensive.  All this will be done in \Cref{sec:expl-conf-1}.

To remedy this problem we use our weaker formulation
\Cref{alg:explore-implications-weaker-version} and derive from it in
\Cref{sec:poss-fast-expl} an algorithm for exploration by confidence that avoids computing
closures under $\Th_{c}(\con K)$.  The price we have to pay for this simplification are an
increase in the number of questions asked to the expert, and the fact that we do not
compute the canonical base anymore.

\subsection{Exploration by Confidence from Exploration of Sets of Implications}
\label{sec:expl-conf-1}

As already mentioned, we obtain our first algorithm for exploration by confidence by
instantiating \Cref{alg:explore-implications} with $\mathcal{L} = \Th_{c}(\con K)$.  The
first problem we have to face here is how to implement \Cref{lst:explore-implications-1}, \ie
\begin{equation*}
  \mathcal{L}_{i+1} := \set{ (A \to B) \in \mathcal{L}_{i} \mid A \not\subseteq C \text{
      or } B \subseteq C }.
\end{equation*}
Naively, if $\mathcal{L} = \Th_{c}(\con K)$, this statement can be implemented by
enumerating all implications in $\Th_{c}(\con K)$, an approach which we want to avoid for
obvious reasons.  Instead, we collect all counterexamples in a formal context $\con L_{i}$
as we did in \Cref{thm:explore-implications-counterexamples-context}, and then use the
fact which we already used in the proof of this statement (\Cref{eq:40}), which in our
case amounts to
\begin{equation*}
  \mathcal{L}_{i} = \Th_{c}(\con K) \cap \Th(\con L_{i}).
\end{equation*}

\addfunctionname{exploration-by-confidence}

\begin{figure}[tp]
  \centering
  \begin{Algorithm}[Exploration by Confidence, First Version]
    \label{alg:exploration-by-confidence-first-version}
    \hspace*{0cm}
\begin{lstlisting}
define exploration-by-confidence($\con K = (G, M, I)$, $\leq_M$, $p$, $c \in [0,1]$, $\mathcal{K} \subseteq \Th(p)$)
  $i$ := 0, $\con L_{i} = (\emptyset, M, \emptyset)$, $\mathcal{K}_i$ := $\mathcal{K}$, $P_i$ := $\emptyset$

  while $P_i \neq$ nil do
    $\mathcal{L}_{i}$ := $\Th_{c}(\con K) \cap \Th(\con L_{i})$
    $P_{i+1}$ := next-closed-non-closed($M$, $\leq_M$, $P_i$, $\mathcal{K}_i$, $\mathcal{L}_i$)

    if $p(P_{i+1} \to \mathcal{L}_i(P_{i+1})) = \top$ then
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i \cup \set{ P_{i+1} \to \mathcal{L}_i(P_{i+1}) }$
      $\con L_{i+1}$ := $\con L_{i}$
    else
      $\mathcal{K}_{i+1}$ := $\mathcal{K}_i$
      $\con L_{i+1}$ := $\con L_{i} + p(P_{i+1} \to \mathcal{L}_i(P_{i+1}))$ ;; add counterexample to $\con L_{i}$
    end

    $i$ := $i + 1$
  end while

  return $\mathcal{K}_i$  
end
\end{lstlisting}
  \end{Algorithm}
\end{figure}

The algorithm we thus obtain from \Cref{alg:explore-implications} is shown in
\Cref{alg:exploration-by-confidence-first-version}.  Its correctness and the fact that it
computes the canonical base of $\Th(p) \cap \Th_{c}(\con K)$ with background knowledge
$\mathcal{K}$ are now immediate consequences of our foregone discussions.

\begin{Corollary}
  \label{cor:exploration-by-confidence-first-version}
  Let $\con K = (G, M, I)$ be a finite formal context, $\leq_{M}$ a linear order on $M$,
  $c \in [0,1]$, $p$ a domain expert on $M$ and $\mathcal{K} \subseteq \Th_{c}(\con K)
  \cap \Th(p)$.  Then the call
  \begin{equation*}
    \text{\lstinline{exploration-by-confidence}}(\con K, \leq_{M}, p, c, \mathcal{K})
  \end{equation*}
  terminates after finitely many steps.  If $n$ is the number of iterations of this call,
  and if $\mathcal{K}_{n}$ is the corresponding return value, then $\mathcal{K}_{n}
  \setminus \mathcal{K}$ is a base of $\Th(p) \cap \Th_{c}(\con K)$ with background
  knowledge $\mathcal{K}$, \ie
  \begin{equation*}
    \Cn(\mathcal{K}_{n}) = \Cn(\Th(p) \cap \Th_{c}(\con K)).
  \end{equation*}
  More precisely, $\mathcal{K}_{n} \setminus \mathcal{K}$ is the canonical base of $\Th(p)
  \cap \Th_{c}(\con K)$ with background knowledge $\mathcal{K}$, formally
  \begin{equation*}
    \mathcal{K}_{n} \setminus \mathcal{K} = \Can(\Th(p) \cap \Th_{c}(\con K), \mathcal{K}).
  \end{equation*}
\end{Corollary}

Recall that when we motivated exploration by confidence that we mentioned that in such an
implementation we would need to distinguish between different forms of counterexamples: if
$(A \to B) \in \Imp(M)$, then the counterexamples for $A \to B$ contained in $\con K$ can
possibly be ignored if only $\conf_{\con K}(A \to B) \ge c$.  On the other hand, if our
expert $p$ provides a counterexample for $A \to B$, then this counterexample cannot be
ignored, even if the confidence of $A \to B$ would still be sufficiently high.

Our \Cref{alg:exploration-by-confidence-first-version} solves this problem by just
considering two formal contexts, namely $\con K$ on the one hand, where we apply the
confidence threshold, and $\con L_{i}$ on the other hand, of which we only consider valid
implications.  This distinction is immediate if we consider the definition of
$\mathcal{L}_{i}$, namely
\begin{equation*}
  \mathcal{L}_{i} = \Th_{c}(\con K) \cap \Th(\con L_{i}).
\end{equation*}

Of course this solution is only practical if we can efficiently compute closures under
$\mathcal{L}_{i}$.  As already mentioned, we want to avoid enumerating $\Th_{c}(\con K)$
at all costs, as otherwise the algorithm impractical even from a theoretical point of
view.  In the following we want to discuss an approach which allows to compute such
closures.

In what follows we shall consider derivation in various contexts, namely in $\con K$,
$\con L_{i}$ and the \emph{subposition} of $\con K = (G, M, I)$ and $\con L_{i} = (G_{i},
M, I_{i})$, which is the formal context
\begin{equation*}
  \con K \div \con L_{i} := \frac {\con K} {\con L_{i}} := (G \cup G_{i}, M, I \cup I_{i}),
\end{equation*}
where we assume that $G$ and $G_{i}$ as well as $I$ and $I_{i}$ are disjoint.  To avoid
confusion we shall denote thus denote the derivation operators by $(\cdot)'_{\con K}$,
$(\cdot)'_{\con L_{i}}$ and $(\cdot)'_{\con K \div \con L_{i}}$, respectively.  To ease
readability, we shall also write $(\cdot)''_{\con K}$ instead of $((\cdot)'_{\con
  K})'_{\con K}$, and likewise for the other contexts.

To achieve the computation of $\mathcal{L}_{i}(P)$ for some $P$ we first recall the
definition of $\mathcal{L}_{i}(P)$ as given in \Cref{def:induced-closure-operator}.  There
we had defined
\begin{align*}
  \mathcal{L}^{1}(P) &:= P \cup \bigcup \set{ B \mid (A \to B) \in \mathcal{L}, A
    \subseteq P }, \\
  \mathcal{L}^{j+1}(P) &:= \mathcal{L}^{1}(\mathcal{L}^{j}(P)) \quad (j \in \NN_{> 0}), \\
  \mathcal{L}(P) & := \bigcup_{i \in \NN_{>0}} \mathcal{L}^{i}(P).
\end{align*}
Therefore, if we can find a way to compute $\mathcal{L}_{i}^{1}(P)$ for $\mathcal{L}_{i} =
\Th_{c}(\con K) \cap \Th(\con L_{i})$ then we are in principle also able to compute
$\mathcal{L}_{i}(P)$.  Note that we only have to consider $\mathcal{L}_{i}^{j}(P)$ for up
to at most $j = \abs M$, because $\abs{ \mathcal{L}_{i}(P) } \le \abs M$.

As a first observation to compute $\mathcal{L}_{i}^{1}(P)$ for arbitrary $P \subseteq M$
we observe that
\begin{equation}
  \label{eq:41}
  P_{\con K \div \con L_{i}}'' \subseteq \mathcal{L}_{i}^{1}(P).
\end{equation}
This is because on the one hand we have $P_{\con K \div \con L_{i}}'' \subseteq P_{\con
  K}''$ and thus the implication $P \to P_{\con K \div \con L_{i}}''$ is valid in $\con
K$, and in particular $(P \to P_{\con K \div \con L_{i}}'') \in \Th_{c}(\con K)$.
On other hand, the same argumentation shows that $P_{\con K \div \con L_{i}}'' \subseteq
P_{\con L_{i}}''$, and thus $(P \to P_{\con K \div \con L_{i}}'') \in \Th(\con L_{i})$.
Putting these facts together we obtain
\begin{equation*}
  (P \to P_{\con K \div \con L_{i}}'') \in \Th_{c}(\con K) \cap \Th(\con L_{i}) = \mathcal{L}_{i}
\end{equation*}
and therefore $P_{\con K \div \con L_{i}}'' \subseteq \mathcal{L}_{i}^{1}(P)$.

To completely compute $\mathcal{L}_{i}^{1}(P)$ we need to consider all implications $(A
\to B) \in \mathcal{L}_{i}$ such that $A \subseteq P$.  If $A \to B$ is valid in $\con K$
then we know that $B \subseteq P_{\con K \div \con L_{i}}''$.  Therefore, by \Cref{eq:41},
the difficult part in computing $\mathcal{L}_{i}^{1}(P)$ is to compute the set
\begin{equation*}
  \mathcal{L}_{i}^{1}(P) \setminus P_{\con K \div \con L_{i}}''.
\end{equation*}
For this we need to consider implications $A \to B$ which are not valid in $\con K$, but
whose confidence is at least $c$ in $\con K$, \ie
\begin{equation*}
  1 > \conf_{\con K}(A \to B) \ge c.
\end{equation*}
Additionally, we can assume without loss of generality that $\abs B = 1$, because
\begin{equation*}
  \conf_{\con K}(A \to \set{ b }) \ge \conf_{\con K}(A \to B)
\end{equation*}
is true for all $b \in B$.

\todo[inline]{Write: 13-04/4.1}%

\subsection{Avoiding Closures under $\Th_{c}(\con K)$}
\label{sec:poss-fast-expl}

\todo[inline]{Write: 13-04/4.2}%
\todo[inline]{Write: say that we can also now ask only implications whose confidence is
  high enough}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../main"
%%% End: 

%  LocalWords:  expl attr gener
